!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs/Subject"),require("rxjs/Subscription"),require("util"),require("ngx-emoji/ngx-emoji.min.css"),require("ngx-emoji/emojis.min.css")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","rxjs/Subject","rxjs/Subscription","util","ngx-emoji/ngx-emoji.min.css","ngx-emoji/emojis.min.css"],t):t(e["ngx-emoji"]={},e.ng.core,e.ng.common,e.Rx,e.Rx,e.util)}(this,function(e,t,n,i,o,r){"use strict";var s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=function(){function e(){this.onEmojiPicked=new i.Subject}return e.prototype.setActiveComponent=function(e){this.activeComponent=e},e.prototype.isActiveComponent=function(e){return e===this.activeComponent},e}();a.decorators=[{type:t.Injectable}],a.ctorParameters=function(){return[]};var l={Bold:"bold",Italic:"italic",Underline:"underline"},u=function(){function e(e,n){this.elRef=e,this._contenteditable=!1,this._enterOn={shift:!1,ctrl:!1},this.prevent={text:null,entities:null},this.emojiServiceSubscription=new o.Subscription,this.allowedTags=["b","i","u","strong","em"],this.onContenteditable=new t.EventEmitter,this.onEnterOn=new t.EventEmitter,this.onFullHtml=new t.EventEmitter,this.onHtml=new t.EventEmitter,this.onText=new t.EventEmitter,this.onEntities=new t.EventEmitter,this.onEnter=new t.EventEmitter;var i=this;n.setActiveComponent(this),this.emojiService=n;var r=this.emojiService.onEmojiPicked.subscribe(function(e){n.isActiveComponent(i)&&i.insertEmoji(e)});this.emojiServiceSubscription.add(r),this.getNativeElement().appendChild(document.createTextNode(""));var s=document.createRange();s.setStart(this.getNativeElement().firstChild,0),this.lastSelectionRange=s,document.onselectionchange!==undefined&&document.addEventListener("selectionchange",function(){i.onSelectionchange()})}return e.prototype.getNativeElement=function(){return this.elRef.nativeElement},e.prototype.ngOnDestroy=function(){this.emojiServiceSubscription.unsubscribe()},e.prototype.addEmojiService=function(e){e.setActiveComponent(this);var t=this,n=e.onEmojiPicked.subscribe(function(n){e.isActiveComponent(t)&&t.insertEmoji(n)});this.emojiServiceSubscription.add(n)},Object.defineProperty(e.prototype,"inputPicker",{set:function(e){this.emojiServiceSubscription.unsubscribe(),this.emojiServiceSubscription=new o.Subscription;var t=new a;t.setActiveComponent(this),this.emojiService=t,e.setEmojiService(t);var n=this,i=this.emojiService.onEmojiPicked.subscribe(function(e){t.isActiveComponent(n)&&n.insertEmoji(e)});this.emojiServiceSubscription.add(i)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attrContenteditable",{set:function(e){this.contenteditable=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contenteditable",{get:function(){return this._contenteditable},set:function(e){this._contenteditable=e,this.elRef.nativeElement.setAttribute("contenteditable",e),this.onContenteditable.emit(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enterOn",{get:function(){return this._enterOn},set:function(e){this._enterOn=e,this.onEnterOn.emit(e)},enumerable:!0,configurable:!0}),e.prototype.enterKeyIsEnter=function(){return!this.enterKeyIsShiftEnter()&&!this.enterKeyIsCtrlEnter()},e.prototype.enterKeyIsCtrlEnter=function(){return!!this.enterOn.ctrl},e.prototype.enterKeyIsShiftEnter=function(){return!!this.enterOn.shift},Object.defineProperty(e.prototype,"fullHtml",{get:function(){var e,t,n=document.createElement("div");n.innerHTML=this.getNativeElement().innerHTML;try{for(var i=s(this.arrayOfNodeList(n.getElementsByTagName("img"))),o=i.next();!o.done;o=i.next()){var r=o.value;if(r.classList.contains("ngx-emoji")){var a=document.createElement("i");a.className=r.className,a.setAttribute("aria-hidden","true"),r.parentElement.insertBefore(a,r),r.remove()}}}catch(l){e={error:l}}finally{try{o&&!o.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}return n.innerHTML},set:function(e){this.getNativeElement().innerHTML=this.filterHtml(e,this.allowedTags)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"html",{get:function(){return this.getHtml(this.getNativeElement())},set:function(e){this.getNativeElement().innerHTML=this.filterHtml(e,this.allowedTags)},enumerable:!0,configurable:!0}),e.prototype.getHtml=function(e){var t=this,n="",i=function(o){try{for(var r=s(t.arrayOfNodeList(o)),a=r.next();!a.done;a=r.next()){var l=a.value,u=t.isBlockNode(l);t.isEmojiNode(l)?n+=t.emojiToSymbol(t.emojiFromNode(l)):l.hasChildNodes()?(u||(n+="<"+l.nodeName.toLowerCase()+">"),i(l.childNodes),u||(n+="</"+l.nodeName.toLowerCase()+">")):n+=t.replaceAll(l.textContent,"\n",""),u&&!e.lastChild.isSameNode(l)&&(n+="\n"),"BR"==l.nodeName&&"BR"!=l.parentNode.firstChild.nodeName&&1!=l.parentNode.childNodes.length&&e.lastChild.lastChild&&!e.lastChild.lastChild.isSameNode(l)&&(n+="\n"),!u&&l.previousSibling&&l.previousSibling.textContent.length>0&&l.nextSibling&&t.isBlockNode(l.nextSibling)&&l.parentNode.isSameNode(e)&&(n+="\n"),t.isEmojiNode(l)&&l.nextElementSibling&&t.isBlockNode(l.nextElementSibling)&&0==l.nextSibling.textContent.length&&(n+="\n")}}catch(m){c={error:m}}finally{try{a&&!a.done&&(d=r["return"])&&d.call(r)}finally{if(c)throw c.error}}var c,d};return i(e.childNodes),n=this.replaceAll(n," "," "),n=this.replaceAll(n,"&nbsp;"," ")},Object.defineProperty(e.prototype,"text",{get:function(){return this.filterHtml(this.html)},set:function(e){if(this.contenteditable||e!=this.prevent.text){this.prevent.text=e,e=this.filterHtml(e),e=this.replaceAll(e," "," "),e=this.replaceAll(e,"  ","&nbsp;&nbsp;");var t=(e=this.replaceSymbolsToEmojis(e)).split("\n");e="";try{for(var n=s(t),i=n.next();!i.done;i=n.next()){var o=i.value;0==o.length&&(o="<br>")," "==o&&(o="&nbsp;"),e+="<div>"+o+"</div>"}}catch(c){r={error:c}}finally{try{i&&!i.done&&(a=n["return"])&&a.call(n)}finally{if(r)throw r.error}}this.getNativeElement().innerHTML=e,0==this.getNativeElement().childNodes.length&&this.getNativeElement().appendChild(document.createTextNode(""));for(var r,a,l=document.createRange(),u=this.getNativeElement().lastChild;u.hasChildNodes();)u=u.lastChild;l.setStart(u,u.textContent.length),this.lastSelectionRange=l}},enumerable:!0,configurable:!0}),e.prototype.normalizeEntityType=function(e){if(!e||!r.isString(e)||0==e.trim().length)return null;for(var t in l)if(t.toUpperCase()==e.toUpperCase())return l[t];return null},Object.defineProperty(e.prototype,"entities",{get:function(){var e=this,t=[],n=function(i,o){try{for(var r=s(e.arrayOfNodeList(i)),a=r.next();!a.done;a=r.next()){var u=a.value;if(u.textContent.trim().length>0){var c=u.nodeName.toUpperCase();"B"!=c&&"STRONG"!=c||t.push({type:l.Bold,offset:o,length:u.textContent.length}),"I"!=c&&"EM"!=c||t.push({type:l.Italic,offset:o,length:u.textContent.length}),"U"==c&&t.push({type:l.Underline,offset:o,length:u.textContent.length})}n(u.childNodes,o),o+=u.textContent.length}}catch(p){d={error:p}}finally{try{a&&!a.done&&(m=r["return"])&&m.call(r)}finally{if(d)throw d.error}}var d,m},i=document.createElement("div");return i.innerHTML=this.html,n(i.childNodes,0),i.remove(),t},set:function(e){if(this.contenteditable||JSON.stringify(e)!=JSON.stringify(this.prevent.entities)){this.prevent.entities=e;var t=this,n=this.getNativeElement(),i=window.getSelection(),o=i.rangeCount?i.getRangeAt(0):null,a=this.contenteditable;r.isArray(e)||(e=[]),e=e.filter(function(e){return e.type=t.normalizeEntityType(e.type),!!e.type});var l=this.text;this.text="",this.text=l,this.contenteditable=!0;var u,c,d=!1,m=function(e){var o=document.createRange(),r=0,s=function(n){for(var i=0;i<n.length;i++){var a=n.item(i);if(t.isEmojiNode(a)){var l=t.emojiToSymbol(t.emojiFromNode(a)).length;r<=e.offset&&r+l>=e.offset&&o.setStartBefore(a),r<=e.offset+e.length&&r+l>=e.offset+e.length&&(o.setEndAfter(a),d=!0),r+=l}else{if(a.hasChildNodes())s(a.childNodes);else if("BR"!=a.nodeName){l=a.textContent.length;r<=e.offset&&r+l>=e.offset&&o.setStart(a,e.offset-r),r<=e.offset+e.length&&r+l>=e.offset+e.length&&(o.setEnd(a,e.offset+e.length-r),d=!0),r+=l}t.isBlockNode(a)&&(r++,e.offset+e.length==r&&(o.setEndAfter(a.lastChild),d=!0))}}};s(n.childNodes),d||o.setEndAfter(n.lastChild),i.removeAllRanges(),i.addRange(o),p.formatText(e.type)},p=this;try{for(var f=s(e),h=f.next();!h.done;h=f.next()){m(h.value)}}catch(g){u={error:g}}finally{try{h&&!h.done&&(c=f["return"])&&c.call(f)}finally{if(u)throw u.error}}i.removeAllRanges(),o&&i.addRange(o),this.contenteditable=a}},enumerable:!0,configurable:!0}),e.prototype.onKeydownEnter=function(e){this.contenteditable&&(e.preventDefault(),this.enterKeyIsEnter()?this.emitEnter():this.insertNewLine())},e.prototype.onKeydownControlEnter=function(e){this.contenteditable&&(e.preventDefault(),this.enterKeyIsCtrlEnter()?this.emitEnter():this.insertNewLine())},e.prototype.onKeydownShiftEnter=function(e){this.contenteditable&&(e.preventDefault(),this.enterKeyIsShiftEnter()&&this.emitEnter())},e.prototype.emitEnter=function(){this.onText.emit(this.text),this.onEntities.emit(this.entities),this.onFullHtml.emit(this.fullHtml),this.onHtml.emit(this.html),this.onEnter.emit()},e.prototype.onKeydown=function(e){e.ctrlKey&&66==e.keyCode&&(e.preventDefault(),this.formatText(l.Bold)),e.ctrlKey&&73==e.keyCode&&(e.preventDefault(),this.formatText(l.Italic)),e.ctrlKey&&85==e.keyCode&&(e.preventDefault(),this.formatText(l.Underline))},e.prototype.onFocus=function(){this.emojiService.setActiveComponent(this)},e.prototype.onFocusout=function(){document.onselectionchange===undefined&&(this.lastSelectionRange=window.getSelection().getRangeAt(0))},e.prototype.onSelectionchange=function(){var e=window.getSelection();e.containsNode(this.getNativeElement(),!0)&&(this.lastSelectionRange=e.getRangeAt(0))},e.prototype.onPaste=function(e){e.preventDefault();var t="";e.clipboardData.types.indexOf("text/html")>-1?t=e.clipboardData.getData("text/html"):e.clipboardData.types.indexOf("text/plain")>-1&&(t=e.clipboardData.getData("text/plain")),t=this.filterHtml(t,this.allowedTags),t=this.replaceSymbolsToEmojis(t),this.execCommand("insertHTML",t)},e.prototype.onCopy=function(e){var t=window.getSelection().getRangeAt(0);if(!t.collapsed){e.preventDefault();var n=window.getSelection().getRangeAt(0).cloneContents(),i=document.createElement("div");i.appendChild(n),i.innerHTML=this.getHtml(i),document.getElementsByTagName("body")[0].appendChild(i);var o=document.createRange();o.setStartBefore(i.firstChild),o.setEndAfter(i.lastChild);var r=window.getSelection();r.removeAllRanges(),r.addRange(o),this.execCommand("copy"),i.remove(),r.removeAllRanges(),r.addRange(t)}},e.prototype.onCut=function(e){this.onCopy(e),this.execCommand("delete")},e.prototype.arrayOfNodeList=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.item(n));return t},e.prototype.isBlockNode=function(e){return e instanceof HTMLElement&&(e instanceof HTMLDivElement||"block"==window.getComputedStyle(e,"").display)},e.prototype.isEmojiNode=function(e){return e instanceof HTMLElement&&e.classList.contains("ngx-emoji")},e.prototype.emojiFromNode=function(e){if(!this.isEmojiNode(e))return null;for(var t=e.classList,n=null,i=0;i<t.length;i++)if("ngx-emoji-"==t.item(i).substr(0,10)){n=t.item(i).substr(10);break}return n},e.prototype.replaceSymbolsToEmojis=function(e){var t=this;return e=e.replace(this.getEmojiRegex(),function(e){return t.createEmojiImg(t.emojiFromSymbol(e))}),e=this.replaceAll(e,"️","")},e.prototype.replaceAll=function(e,t,n){return t=t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),e.replace(new RegExp(t,"g"),n)},e.prototype.execCommand=function(e,t){return document.execCommand(e,!1,t)},e.prototype.insertNewLine=function(){this.execCommand("insertParagraph")},e.prototype.createEmojiImg=function(e){return'<img class="ngx-emoji ngx-emoji-'+e+'" aria-hidden="true" alt="'+this.emojiToSymbol(e)+'" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=">'},e.prototype.emojiToSymbol=function(e){if(0==(e=e.trim()).length)return"�";var t=e.split("-").map(function(e){return parseInt("0x"+e,16)});try{e=String.fromCodePoint.apply(String,t)}catch(n){console.warn("Convert emoji "+e+" error: "+n.message),e="�"}return e},e.prototype.emojiFromSymbol=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.codePointAt(n).toString(16));return(t=t.filter(function(e){var t=parseInt(e,16);return!(t>=55296&&t<=57343)}).map(function(e){return"0000".substring(0,"0000".length-e.length)+e})).join("-").toUpperCase()},e.prototype.insertEmoji=function(e){if(this.contenteditable){var t=window.getSelection();t.removeAllRanges(),t.addRange(this.lastSelectionRange),this.execCommand("insertHTML",this.createEmojiImg(e))}},e.prototype.filterHtml=function(e,t){void 0===t&&(t=[]);var n=this;t=t.map(function(e){return e.toUpperCase()});var i=document.createElement("div");i.innerHTML=e,e="";var o=function(i){try{for(var r=s(n.arrayOfNodeList(i)),a=r.next();!a.done;a=r.next()){var l=a.value;l.nodeType==l.ELEMENT_NODE?t.indexOf(l.nodeName)>-1?(e+="<"+l.nodeName.toLowerCase()+">",o(l.childNodes),e+="</"+l.nodeName.toLowerCase()+">"):o(l.childNodes):e+=l.textContent}}catch(d){u={error:d}}finally{try{a&&!a.done&&(c=r["return"])&&c.call(r)}finally{if(u)throw u.error}}var u,c};return o(i.childNodes),i.remove(),e},e.prototype.formatText=function(e){switch(e){case l.Bold:this.execCommand("bold");break;case l.Italic:this.execCommand("italic");break;case l.Underline:this.execCommand("underline")}},e.prototype.getEmojiRegex=function(){return/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c[\ude32\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|[\ud83c[\ude50\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g},e}();u.decorators=[{type:t.Component,args:[{selector:"ngx-emoji",template:""}]}],u.ctorParameters=function(){return[{type:t.ElementRef},{type:a}]},u.propDecorators={inputPicker:[{type:t.Input,args:["picker"]}],attrContenteditable:[{type:t.Input,args:["attr.contenteditable"]}],contenteditable:[{type:t.Input,args:["contenteditable"]}],onContenteditable:[{type:t.Output,args:["contenteditable"]}],enterOn:[{type:t.Input,args:["enterOn"]}],onEnterOn:[{type:t.Output,args:["enterOn"]}],fullHtml:[{type:t.Input,args:["fullHtml"]}],onFullHtml:[{type:t.Output,args:["fullHtml"]}],html:[{type:t.Input,args:["html"]}],onHtml:[{type:t.Output,args:["html"]}],text:[{type:t.Input,args:["text"]}],onText:[{type:t.Output,args:["text"]}],entities:[{type:t.Input,args:["entities"]}],onEntities:[{type:t.Output,args:["entities"]}],onEnter:[{type:t.Output,args:["enter"]}],onKeydownEnter:[{type:t.HostListener,args:["keydown.enter",["$event"]]}],onKeydownControlEnter:[{type:t.HostListener,args:["keydown.control.enter",["$event"]]}],onKeydownShiftEnter:[{type:t.HostListener,args:["keydown.shift.enter",["$event"]]}],onKeydown:[{type:t.HostListener,args:["keydown",["$event"]]}],onFocus:[{type:t.HostListener,args:["focus"]}],onFocusout:[{type:t.HostListener,args:["focusout"]}],onPaste:[{type:t.HostListener,args:["paste",["$event"]]}],onCopy:[{type:t.HostListener,args:["copy",["$event"]]}],onCut:[{type:t.HostListener,args:["cut",["$event"]]}]};var c=function(){function e(e){this.emojiService=e,this.emojis=[]}return e.prototype.ngOnInit=function(){this.emojis=require("ngx-emoji/emojis.json")},e.prototype.setEmojiService=function(e){this.emojiService=e},Object.defineProperty(e.prototype,"inputFor",{set:function(e){this.emojiService=new a,e.addEmojiService(this.emojiService)},enumerable:!0,configurable:!0}),e.prototype.emojiPicked=function(e){this.emojiService.onEmojiPicked.next(e)},e}();c.decorators=[{type:t.Component,args:[{selector:"ngx-emoji-picker",template:'<i *ngFor="let emoji of emojis"\n   [class]="\'ngx-emoji ngx-emoji-\' + emoji.unified"\n   aria-hidden="true"\n   (click)="emojiPicked(emoji.unified)"\n></i>\n'}]}],c.ctorParameters=function(){return[{type:a}]},c.propDecorators={inputFor:[{type:t.Input,args:["for"]}]};var d=function(){return function(){}}();d.decorators=[{type:t.NgModule,args:[{imports:[n.CommonModule],declarations:[c,u],providers:[a],exports:[c,u]}]}],d.ctorParameters=function(){return[]},e.NgxEmojiModule=d,e.NgxEmojiPickerComponent=c,e.NgxEmojiComponent=u,e.NgxEmojiEntityType=l,e.NgxEmojiService=a,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-emoji.umd.min.js.map
